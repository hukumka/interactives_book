# Html templater

###### Complete template code can be found in "examples/euler/template.html"

Create "template.html"

Let's prepare basic layout for our page.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tutorial page</title>
</head>

<body>
    <div class="interface">
    </div>
</body>
```

First to make virtual machine work you need to include related javascript into head:

```html
    <script src="vm/vm.js"></script>
    <script>{code_js}</script>
    <script src="vm/interface.js"></script>
```

* vm.js - javascript implementation of virtual machine
* ```{code_js}``` - template market to insert all vm related data generated by compiler.
* interface.js - interface layer for virtual machine. Handles breakpoint toggles,
showing variable on hover and provide function to initialize virtual machine with
given set of "to be linked" javascript functions.

## page markdown

Next, we need to add page elements:

```html
    <div class="interface">
        <!-- control panel -->
        <div id="controls">
            <div id="flow-control">
                <a id="run">run</a>
                <a id="step">step</a>
                <a id="step-in">step-in</a>
            </div>
            <div id="variables"></div>
        </div>

        <!-- code -->
        <div class="code">
            {code_html}
        </div>
    </div>
``` 

Controlls:

* ```<a id="run">``` - button to start/continue virtual machine evaluation until breakpoint or exit. Important: id="run" required by interface.js to attach event.
* ```<a id="step">``` - button to do one step stepping over function calls if encountered. Important: id="step" required by interface.js to attach event.
* ```<a id="step-in">``` - button to do one step. If function call encountered step into in. Important: id="step-in" required by interface.js to attach event. 

* ```<div id="variables">``` - container for displaying values of variables in current scope. Important: id="variables" is required by interface.js

```<div class="code">{code_html}</div>``` is used to include html representation of code given to compiler into our page.


## Linking

We already done a lot of work, but due to such underdeveloped software design our template is still not ready to be somewhat usefull. 

So here we go. Next step is to add new ```<script>...</script>``` block after all other script imports.


First you'll need to create linkings to functions:

```js

functions = {{}}

functions['sqrt'] = {{
    arg_count: 1,
    func: function(x){{
        return Math.sqrt(x)
    }}
}}
```

First line defines dictionary variable functions which will be used to store info about funciton linking. 

Take a notice of doubling '{{' and '}}'. This bracket escaping required by template system. It is advised to write all javascript in separate files and embeded code is used for this tutorial only to demonstrate such detail.

Next statement marks 'sqrt' item of functions as function taking one argument and executed as 
```js
function(x){
    return Math.sqrt(x)
}
```

Our first function ready! Only one more to go. 

Allocation of array is special case of function. Since it needs to know internal structure of virtualmachine, it was hardcoded into it and can be linked as follow:

```js
functions['alloc_float'] = {{
    arg_count: 1,
    func: "vm.alloc"
}}
```

Where 'vm.alloc' is magical constant. Its *important* to notice that it suitable only for such types as float, int and pointers. So far it's all supported types, but with shipment of *struct* feature (and there for appearance of not 1-sized types will be marked as deprecated.


## Setup vm

Add global variable for storing virtual machine instance, which will be initialized after window loads.

```
var vm=null;

window.onload = function(){
    vm = initialize_vm_interface(functions);
}
```

## Build the thing
After all done, actual page might be created by running command:
```
interactives 0.c -t template.html -o index.html
```

or using cargo in sources repo:
```
cargo run -- 0.c -t template.html -o index.html
```
