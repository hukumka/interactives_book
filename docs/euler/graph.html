<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Add graph - Interactives</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "../";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="../chapter_1_tutorial.html"><strong aria-hidden="true">1.</strong> Usage tutorial</a></li><li><ol class="section"><li><a href="../euler/problem.html"><strong aria-hidden="true">1.1.</strong> Problem</a></li><li><a href="../euler/c_code.html"><strong aria-hidden="true">1.2.</strong> C code</a></li><li><a href="../euler/template.html"><strong aria-hidden="true">1.3.</strong> Page template</a></li><li><a href="../euler/graph.html" class="active"><strong aria-hidden="true">1.4.</strong> Add graph</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Interactives</h1> 

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#graph" id="graph"><h1>Graph</h1></a>
<p>This page describes how to enchant page we built in previous step by adding graph display.</p>
<a class="header" href="#modify-code" id="modify-code"><h2>Modify code</h2></a>
<p>First we need some interface to show page what we want do draw. To do so we'll add new function declaration:</p>
<pre><code class="language-C">void display(float* array, int size);
</code></pre>
<p>and call of this function each iteration of method.</p>
<pre><code class="language-C">    ...
    for(int i=0; i&lt;COUNT; ++i){
        data[i] = f;
        f += step * P(f, x);
        x += step;

        display(data, i);
    }
    ...
}
</code></pre>
<a class="header" href="#add-plotly-script" id="add-plotly-script"><h2>Add plotly script</h2></a>
<pre><code>&lt;script src=&quot;https://cdn.plot.ly/plotly-latest.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>inside head.</p>
<a class="header" href="#add-element-where-graph-will-be-contained" id="add-element-where-graph-will-be-contained"><h2>Add element where graph will be contained</h2></a>
<p>by simply extending our <code>&lt;div class=&quot;interface&quot;&gt;</code> with new child</p>
<pre><code>&lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;
</code></pre>
<a class="header" href="#extracting-data" id="extracting-data"><h2>Extracting data</h2></a>
<p>Now only thing we have to do is to add function link to ploty (or other library you might prefer) as in previous page...</p>
<pre><code class="language-js">functions['display'] = {{
    arg_count: 1,
    func: function(pointer, size){{
        console.log(pointer, size);
        //...
    }}
}}
</code></pre>
<p>Whawhawait, we receiving two integers? What would we do with them?</p>
<p>Unfortunatly, after compilation, virtual machine no longer posseses knowlege about variable type. Therefore it is suppling as with what it can,
and it is our duty to interpret it correcty.</p>
<p>But, we still can access our array using method vm.get_array.</p>
<pre><code class="language-js">var y = vm.get_array(pointer, size);

var x = [];
var STEP = 0.01;
for(var i=0; i&lt;y.length; ++i){{
    x.push(i*STEP);
}}

Plotly.plot(document.getElementById('graph'), [{{x: x, y: y}}]);
</code></pre>
<p>With this we can rebuild our page, open it, press run and get terrifying experiance.
What is this? Page freezes and after centuries passes and it start responding we get what? Billions graph annotations? What the heck?</p>
<a class="header" href="#fix-it" id="fix-it"><h2>Fix it</h2></a>
<p>Lets take a look what gone wrong (althrough you might have recognised problem just by glancing on code). Each time vm finishes other iteration of loop it calls display.
Each time display is called it orders plotly to create new plot on element with id &quot;graph&quot;. And drawing graph is not cheap.</p>
<p>What we can do, is to delay actual drawing until vm pauses. On top of script block:</p>
<pre><code class="language-js">var graph = null; // div element for graph
var graph_data = {{
    x: null,
    y: null,
}};
</code></pre>
<p>Then change code of display to simply putting given array into <code>graph_data.y</code>.</p>
<pre><code class="language-js">func: function(pointer, size){
    graph_data.y = vm.get_array(pointer, size);
}
</code></pre>
<p>Now, then our page loads we initialize graph variable with its element and draw empty graph on it so we can use redraw plotly function.</p>
<pre><code class="language-js">window.onload = function(){{
    vm = initialize_vm_interface(functions);
    graph = document.getElementById('graph');
    Plotly.plot(graph, [graph_data], {{margin: {{t: 0}} }});
}}
</code></pre>
<p>And then we need to use callback vm.on_break to draw graph.</p>
<pre><code class="language-js">window.onload = function(){{
    vm = initialize_vm_interface(functions);
    graph = document.getElementById('graph');
    Plotly.plot(graph, [graph_data], {{margin: {{t: 0}} }});

    vm.on_break = function(){{
        // if breakpoint reached before and data been supplied.
        if(graph_data.y === null){{
            return;
        }}
        // update grapth
        var x = [];
        var STEP = 0.01;
        for(var i=0; i&lt;graph_data.y.length; ++i){{
            x.push(i*STEP);
        }}
        graph_data.x = x;
        Plotly.redraw(graph);
    }}
}}
</code></pre>
<p>After rebuilding page whose two problems should dissapear.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../euler/template.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../euler/template.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
